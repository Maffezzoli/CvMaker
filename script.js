const translations = {
    'pt-BR': {
        pageTitle: 'Gerador de Currículos',
        customization: {
            selectLanguage: 'Selecione o idioma',
            selectTemplate: 'Selecione o template',
            primaryColor: 'Escolha a cor primária',
            secondaryColor: 'Escolha a cor secundária',
            selectFont: 'Selecione a fonte',
            fontGroups: {
                sansSerif: 'Sans Serif',
                serif: 'Serif',
                monospace: 'Monospace'
            }
        },
        titles: {
            experience: 'Experiência Profissional',
            education: 'Educação',
            skills: 'Habilidades',
            summary: 'Resumo Profissional',
            contact: 'Informações de Contato',
            customize: 'Personalização',
            mainTitle: 'Informações do Currículo',
            personalInfo: 'Informações Pessoais',
            professionalSummary: 'Resumo Profissional',
            professionalExperience: 'Experiência Profissional',
            education: 'Educação',
            skills: 'Habilidades'
        },
        labels: {
            email: 'Email',
            phone: 'Telefone',
            address: 'Endereço',
            current: 'Atual',
            template: 'Template',
            primaryColor: 'Cor Primária',
            secondaryColor: 'Cor Secundária',
            font: 'Fonte',
            templates: {
                minimal: 'Minimalista',
                professional: 'Profissional',
                modern: 'Moderno',
                creative: 'Criativo',
                elegant: 'Elegante',
                bold: 'Arrojado',
                tech: 'Tecnológico',
                classic: 'Clássico'
            },
            formSections: {
                personalInfo: 'Informações Pessoais',
                professionalSummary: 'Resumo Profissional',
                experience: 'Experiência Profissional',
                education: 'Educação',
                skills: 'Habilidades'
            },
            inputs: {
                name: 'Nome Completo*',
                email: 'E-mail*',
                phone: 'Telefone*',
                address: 'Endereço',
                linkedin: 'LinkedIn',
                photo: 'Foto de Perfil',
                chooseFile: 'Escolher arquivo',
                photoSize: 'Tamanho máximo: 2MB',
                summary: 'Resumo',
                summaryPlaceholder: 'Breve descrição sobre você e seus objetivos profissionais',
                company: 'Empresa',
                position: 'Cargo',
                startDate: 'Data Início',
                endDate: 'Data Fim',
                description: 'Descrição das atividades',
                institution: 'Instituição',
                course: 'Curso',
                skillsPlaceholder: 'Digite uma habilidade e pressione Enter'
            },
            buttons: {
                addExperience: '+ Adicionar Experiência',
                addEducation: '+ Adicionar Educação',
                generatePDF: 'Gerar PDF',
                save: 'Salvar Localmente',
                load: 'Carregar Dados Salvos',
                remove: 'Remover'
            },
            alerts: {
                photoSize: 'A foto deve ter no máximo 2MB',
                dataSaved: 'Dados salvos com sucesso!',
                dataLoaded: 'Dados carregados com sucesso!',
                noData: 'Nenhum dado salvo encontrado!',
                pdfError: 'Erro ao gerar o PDF. Por favor, tente novamente.'
            },
            cardColor: 'Escolha a cor do card',
            requiredField: 'Campo obrigatório',
            preview: 'Prévia',
            form: {
                title: 'Informações do Currículo',
                required: '*Campos obrigatórios'
            },
            placeholders: {
                company: 'Empresa',
                position: 'Cargo',
                startDate: 'Data Início',
                endDate: 'Data Fim',
                activities: 'Descrição das atividades',
                institution: 'Instituição',
                course: 'Curso',
                enterName: 'Digite seu nome completo',
                enterEmail: 'seu@email.com',
                enterPhone: '(00) 00000-0000',
                enterAddress: 'Cidade, Estado',
                enterLinkedIn: 'https://linkedin.com/in/seu-perfil',
                enterSkill: 'Digite uma habilidade e pressione Enter',
                month: 'Mês',
                year: 'Ano'
            },
            photo: {
                preview: 'Foto',
                maxSize: 'Tamanho máximo: 2MB'
            },
            required: {
                field: 'Campo obrigatório',
                marker: '*'
            }
        }
    },
    'en': {
        pageTitle: 'Resume Generator',
        customization: {
            selectLanguage: 'Select language',
            selectTemplate: 'Select template',
            primaryColor: 'Choose primary color',
            secondaryColor: 'Choose secondary color',
            selectFont: 'Select font',
            fontGroups: {
                sansSerif: 'Sans Serif',
                serif: 'Serif',
                monospace: 'Monospace'
            }
        },
        titles: {
            experience: 'Professional Experience',
            education: 'Education',
            skills: 'Skills',
            summary: 'Professional Summary',
            contact: 'Contact Information',
            customize: 'Customization',
            mainTitle: 'Curriculum Information',
            personalInfo: 'Personal Information',
            professionalSummary: 'Professional Summary',
            professionalExperience: 'Professional Experience',
            education: 'Education',
            skills: 'Skills'
        },
        labels: {
            email: 'Email',
            phone: 'Phone',
            address: 'Address',
            current: 'Present',
            template: 'Template',
            primaryColor: 'Primary Color',
            secondaryColor: 'Secondary Color',
            font: 'Font',
            templates: {
                minimal: 'Minimal',
                professional: 'Professional',
                modern: 'Modern',
                creative: 'Creative',
                elegant: 'Elegant',
                bold: 'Bold',
                tech: 'Tech',
                classic: 'Classic'
            },
            formSections: {
                personalInfo: 'Personal Information',
                professionalSummary: 'Professional Summary',
                experience: 'Professional Experience',
                education: 'Education',
                skills: 'Skills'
            },
            inputs: {
                name: 'Full Name*',
                email: 'Email*',
                phone: 'Phone*',
                address: 'Address',
                linkedin: 'LinkedIn',
                photo: 'Profile Picture',
                chooseFile: 'Choose file',
                photoSize: 'Maximum size: 2MB',
                summary: 'Summary',
                summaryPlaceholder: 'Brief description about you and your professional goals',
                company: 'Company',
                position: 'Position',
                startDate: 'Start Date',
                endDate: 'End Date',
                description: 'Description of activities',
                institution: 'Institution',
                course: 'Course',
                skillsPlaceholder: 'Type a skill and press Enter'
            },
            buttons: {
                addExperience: '+ Add Experience',
                addEducation: '+ Add Education',
                generatePDF: 'Generate PDF',
                save: 'Save Locally',
                load: 'Load Saved Data',
                remove: 'Remove'
            },
            alerts: {
                photoSize: 'The photo must be up to 2MB',
                dataSaved: 'Data saved successfully!',
                dataLoaded: 'Data loaded successfully!',
                noData: 'No saved data found!',
                pdfError: 'Error generating PDF. Please try again.'
            },
            cardColor: 'Choose card color',
            requiredField: 'Required field',
            preview: 'Preview',
            form: {
                title: 'Resume Information',
                required: '*Required fields'
            },
            placeholders: {
                company: 'Company',
                position: 'Position',
                startDate: 'Start Date',
                endDate: 'End Date',
                activities: 'Description of activities',
                institution: 'Institution',
                course: 'Course',
                enterName: 'Enter your full name',
                enterEmail: 'your@email.com',
                enterPhone: 'Phone number',
                enterAddress: 'City, State',
                enterLinkedIn: 'https://linkedin.com/in/your-profile',
                enterSkill: 'Type a skill and press Enter'
            },
            photo: {
                preview: 'Photo',
                maxSize: 'Maximum size: 2MB'
            },
            required: {
                field: 'Required field',
                marker: '*'
            }
        }
    },
    'es': {
        pageTitle: 'Generador de Currículum',
        customization: {
            selectLanguage: 'Seleccionar idioma',
            selectTemplate: 'Seleccionar plantilla',
            primaryColor: 'Elegir color primario',
            secondaryColor: 'Elegir color secundario',
            selectFont: 'Seleccionar fuente',
            fontGroups: {
                sansSerif: 'Sans Serif',
                serif: 'Serif',
                monospace: 'Monospace'
            }
        },
        titles: {
            experience: 'Experiencia Profesional',
            education: 'Educación',
            skills: 'Habilidades',
            summary: 'Resumen Profesional',
            contact: 'Información de Contacto',
            customize: 'Personalización',
            mainTitle: 'Información del Currículum',
            personalInfo: 'Información Personal',
            professionalSummary: 'Resumen Profesional',
            professionalExperience: 'Experiencia Profesional',
            education: 'Educación',
            skills: 'Habilidades'
        },
        labels: {
            email: 'Correo',
            phone: 'Teléfono',
            address: 'Dirección',
            current: 'Actual',
            template: 'Plantilla',
            primaryColor: 'Color Primario',
            secondaryColor: 'Color Secundario',
            font: 'Fuente',
            templates: {
                minimal: 'Minimalista',
                professional: 'Profesional',
                modern: 'Moderno',
                creative: 'Creativo',
                elegant: 'Elegante',
                bold: 'Audaz',
                tech: 'Tecnológico',
                classic: 'Clásico'
            },
            formSections: {
                personalInfo: 'Información Personal',
                professionalSummary: 'Resumen Profesional',
                experience: 'Experiencia',
                education: 'Educación',
                skills: 'Habilidades'
            },
            inputs: {
                name: 'Nombre Completo*',
                email: 'Correo Electrónico*',
                phone: 'Teléfono*',
                address: 'Dirección',
                linkedin: 'LinkedIn',
                photo: 'Foto de Perfil',
                chooseFile: 'Elegir archivo',
                photoSize: 'Tamaño máximo: 2MB',
                summary: 'Resumen',
                summaryPlaceholder: 'Breve descripción sobre ti y tus objetivos profesionales',
                company: 'Empresa',
                position: 'Cargo',
                startDate: 'Fecha de Inicio',
                endDate: 'Fecha de Fin',
                description: 'Descripción de las actividades',
                institution: 'Institución',
                course: 'Curso',
                skillsPlaceholder: 'Escribe una habilidad y presiona Enter'
            },
            buttons: {
                addExperience: '+ Agregar Experiencia',
                addEducation: '+ Agregar Educación',
                generatePDF: 'Generar PDF',
                save: 'Guardar Localmente',
                load: 'Cargar Datos Guardados',
                remove: 'Eliminar'
            },
            alerts: {
                photoSize: 'La foto debe tener un tamaño máximo de 2MB',
                dataSaved: '¡Datos guardados con éxito!',
                dataLoaded: '¡Datos cargados con éxito!',
                noData: '¡No se encontraron datos guardados!',
                pdfError: 'Error al generar el PDF. Por favor, inténtelo de nuevo.'
            },
            cardColor: 'Elegir color de tarjeta',
            requiredField: 'Campo requerido',
            preview: 'Vista previa',
            form: {
                title: 'Información del Currículum',
                required: '*Campos requeridos'
            },
            placeholders: {
                company: 'Empresa',
                position: 'Cargo',
                startDate: 'Fecha de Inicio',
                endDate: 'Fecha de Fin',
                activities: 'Descripción de actividades',
                institution: 'Institución',
                course: 'Curso',
                enterName: 'Ingrese su nombre completo',
                enterEmail: 'su@correo.com',
                enterPhone: 'Número de teléfono',
                enterAddress: 'Ciudad, Estado',
                enterLinkedIn: 'https://linkedin.com/in/su-perfil',
                enterSkill: 'Escriba una habilidad y presione Enter'
            },
            photo: {
                preview: 'Foto',
                maxSize: 'Tamaño máximo: 2MB'
            },
            required: {
                field: 'Campo requerido',
                marker: '*'
            }
        }
    },
    'zh': {
        pageTitle: '简历生成器',
        customization: {
            selectLanguage: '选择语言',
            selectTemplate: '选择模板',
            primaryColor: '选择主要颜色',
            secondaryColor: '选择次要颜色',
            selectFont: '选择字体',
            fontGroups: {
                sansSerif: '无衬线字体',
                serif: '衬线字体',
                monospace: '等宽字体'
            }
        },
        titles: {
            experience: '工作经验',
            education: '教育背景',
            skills: '技能特长',
            summary: '个人简介',
            contact: '联系方式',
            customize: '个性化',
            mainTitle: '简历信息',
            personalInfo: '个人信息',
            professionalSummary: '个人简介',
            professionalExperience: '工作经验',
            education: '教育背景',
            skills: '技能特长'
        },
        labels: {
            email: '邮箱',
            phone: '电话',
            address: '地址',
            current: '至今',
            template: '模板',
            primaryColor: '主要颜色',
            secondaryColor: '次要颜色',
            font: '字体',
            templates: {
                minimal: '简约',
                professional: '专业',
                modern: '现代',
                creative: '创意',
                elegant: '优雅',
                bold: '大胆',
                tech: '科技',
                classic: '经典'
            },
            formSections: {
                personalInfo: '个人信息',
                professionalSummary: '职业概述',
                experience: '工作经验',
                education: '教育背景',
                skills: '技能特长'
            },
            inputs: {
                name: '姓名*',
                email: '电子邮件*',
                phone: '电话*',
                address: '地址',
                linkedin: '领英',
                photo: '个人照片',
                chooseFile: '选择文件',
                photoSize: '最大尺寸：2MB',
                summary: '概述',
                summaryPlaceholder: '简要描述您自己和职业目标',
                company: '公司',
                position: '职位',
                startDate: '开始日期',
                endDate: '结束日期',
                description: '活动描述',
                institution: '学院',
                course: '课程',
                skillsPlaceholder: '输入技能并按Enter'
            },
            buttons: {
                addExperience: '+ 添加工作经验',
                addEducation: '+ 添加教育经历',
                generatePDF: '生成PDF',
                save: '本地保存',
                load: '加载保存数据',
                remove: '删除'
            },
            alerts: {
                photoSize: '照片大小不得超过2MB',
                dataSaved: '数据保存成功！',
                dataLoaded: '数据加载成功！',
                noData: '未找到保存的数据！',
                pdfError: 'PDF生成错误。请重试。'
            },
            cardColor: '选择卡片颜色',
            requiredField: '必填项',
            preview: '预览',
            form: {
                title: '简历信息',
                required: '*必填字段'
            },
            placeholders: {
                company: '公司',
                position: '职位',
                startDate: '开始日期',
                endDate: '结束日期',
                activities: '工作描述',
                institution: '学校',
                course: '专业',
                enterName: '输入您的全名',
                enterEmail: '您的邮箱',
                enterPhone: '电话号码',
                enterAddress: '城市，省份',
                enterLinkedIn: 'https://linkedin.com/in/您的主页',
                enterSkill: '输入技能并按回车键'
            },
            photo: {
                preview: '照片',
                maxSize: '最大尺寸：2MB'
            },
            required: {
                field: '必填项',
                marker: '*'
            }
        }
    }
};

document.addEventListener('DOMContentLoaded', function() {
    // Elementos do DOM
    const form = document.getElementById('cvForm');
    const previewContainer = document.getElementById('curriculo-preview');
    const addExperienciaBtn = document.getElementById('addExperiencia');
    const addEducacaoBtn = document.getElementById('addEducacao');
    const novaHabilidadeInput = document.getElementById('novaHabilidade');
    const listaHabilidades = document.getElementById('listaHabilidades');
    const salvarLocalBtn = document.getElementById('salvarLocal');
    const carregarLocalBtn = document.getElementById('carregarLocal');
    const gerarPDFBtn = document.getElementById('gerarPDF');
    const templateSelect = document.getElementById('template');
    const fotoInput = document.getElementById('foto');
    const fotoPreview = document.getElementById('fotoPreview');
    const corPrimariaInput = document.getElementById('corPrimaria');
    const corSecundariaInput = document.getElementById('corSecundaria');
    const fonteSelect = document.getElementById('fonte');
    const darkModeToggle = document.getElementById('darkModeToggle');
    const htmlRoot = document.documentElement;

    // Verificar preferência salva
    const darkMode = localStorage.getItem('darkMode') === 'true';
    if (darkMode) {
        htmlRoot.setAttribute('data-theme', 'dark');
        darkModeToggle.querySelector('i').classList.replace('fa-moon', 'fa-sun');
    }

    // Toggle modo escuro
    darkModeToggle.addEventListener('click', () => {
        const isDark = htmlRoot.getAttribute('data-theme') === 'dark';
        htmlRoot.setAttribute('data-theme', isDark ? 'light' : 'dark');
        darkModeToggle.querySelector('i').classList.replace(
            isDark ? 'fa-sun' : 'fa-moon',
            isDark ? 'fa-moon' : 'fa-sun'
        );
        localStorage.setItem('darkMode', !isDark);
    });

    // Event Listeners
    form.querySelectorAll('input, textarea, select').forEach(element => {
        element.addEventListener('input', () => {
            clearTimeout(element.timeoutId);
            element.timeoutId = setTimeout(atualizarPrevia, 300);
        });
    });

    addExperienciaBtn.addEventListener('click', () => adicionarItem('experiencias', criarExperienciaHTML));
    addEducacaoBtn.addEventListener('click', () => adicionarItem('educacao', criarEducacaoHTML));
    novaHabilidadeInput.addEventListener('keypress', adicionarHabilidade);
    salvarLocalBtn.addEventListener('click', salvarDadosLocal);
    carregarLocalBtn.addEventListener('click', carregarDadosLocal);
    gerarPDFBtn.addEventListener('click', gerarPDF);
    templateSelect.addEventListener('change', atualizarPrevia);
    fotoInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            if (file.size > 2 * 1024 * 1024) { // 2MB
                mostrarAlerta('photoSize');
                this.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                fotoPreview.innerHTML = `<img src="${e.target.result}" alt="Foto de perfil">`;
                fotoPreview.classList.remove('empty');
                atualizarPrevia();
            };
            reader.readAsDataURL(file);
        } else {
            fotoPreview.innerHTML = '';
            fotoPreview.classList.add('empty');
            atualizarPrevia();
        }
    });

    // Adicionar listener para mudança de idioma
    document.getElementById('idioma').addEventListener('change', () => {
        atualizarPrevia();
        // Atualizar placeholders do formulário
        atualizarPlaceholders();
        atualizarLabelsPersonalizacao();
    });

    // Event listeners para as opções do header
    corPrimariaInput.addEventListener('input', atualizarPrevia);
    corSecundariaInput.addEventListener('input', atualizarPrevia);
    fonteSelect.addEventListener('change', atualizarPrevia);
    templateSelect.addEventListener('change', atualizarPrevia);

    // Funções de Template
    function criarExperienciaHTML() {
        const idioma = document.getElementById('idioma').value;
        const t = translations[idioma].labels;
        return `
            <div class="experiencia-item">
                <div class="d-flex justify-content-end mb-2">
                    <input type="color" class="form-control form-control-color card-color" 
                           value="#0d6efd" title="${t.cardColor}">
                </div>
                <input type="text" class="form-control mb-2" placeholder="Empresa" title="Nome da Empresa">
                <input type="text" class="form-control mb-2" placeholder="Cargo" title="Cargo">
                <div class="row mb-2">
                    <div class="col">
                        <input type="month" class="form-control" placeholder="Data Início" title="Data Início">
                    </div>
                    <div class="col">
                        <input type="month" class="form-control" placeholder="Data Fim" title="Data Fim">
                    </div>
                </div>
                <textarea class="form-control mb-2" placeholder="Descrição das atividades" title="Descrição"></textarea>
                <button type="button" class="btn btn-danger btn-sm remove-item" onclick="this.closest('.experiencia-item').remove(); atualizarPrevia();">${t.buttons.remove}</button>
            </div>
        `;
    }

    function criarEducacaoHTML() {
        const idioma = document.getElementById('idioma').value;
        const t = translations[idioma].labels;
        return `
            <div class="educacao-item">
                <div class="d-flex justify-content-end mb-2">
                    <input type="color" class="form-control form-control-color card-color" 
                           value="#0d6efd" title="${t.cardColor}">
                </div>
                <input type="text" class="form-control mb-2" placeholder="Instituição" title="Instituição">
                <input type="text" class="form-control mb-2" placeholder="Curso" title="Curso">
                <div class="row mb-2">
                    <div class="col">
                        <input type="month" class="form-control" placeholder="Data Início" title="Data Início">
                    </div>
                    <div class="col">
                        <input type="month" class="form-control" placeholder="Data Fim" title="Data Fim">
                    </div>
                </div>
                <button type="button" class="btn btn-danger btn-sm remove-item" onclick="this.closest('.educacao-item').remove(); atualizarPrevia();">${t.buttons.remove}</button>
            </div>
        `;
    }

    function adicionarItem(containerId, templateFunction) {
        const container = document.getElementById(containerId);
        container.insertAdjacentHTML('beforeend', templateFunction());
        
        const ultimoItem = container.lastElementChild;
        const campos = ultimoItem.querySelectorAll('input, textarea');
        campos.forEach(campo => {
            campo.addEventListener('input', () => {
                clearTimeout(campo.timeoutId);
                campo.timeoutId = setTimeout(atualizarPrevia, 300);
            });
        });
        
        atualizarPrevia();
    }

    function adicionarHabilidade(e) {
        if (e.key === 'Enter' && e.target.value.trim()) {
            e.preventDefault();
            const habilidade = e.target.value.trim();
            const habilidadeElement = document.createElement('span');
            habilidadeElement.className = 'habilidade-tag';
            
            habilidadeElement.textContent = habilidade;
            const removerBtn = document.createElement('span');
            removerBtn.className = 'remover';
            removerBtn.textContent = '×';
            habilidadeElement.appendChild(removerBtn);
            
            removerBtn.addEventListener('click', function() {
                habilidadeElement.remove();
                atualizarPrevia();
            });
            
            listaHabilidades.appendChild(habilidadeElement);
            e.target.value = '';
            atualizarPrevia();
        }
    }

    function validarFormulario() {
        const camposObrigatorios = form.querySelectorAll('[required]');
        let valido = true;
        
        camposObrigatorios.forEach(campo => {
            if (!campo.value.trim()) {
                campo.classList.add('is-invalid');
                valido = false;
            } else {
                campo.classList.remove('is-invalid');
            }
        });

        return valido;
    }

    function formatarData(dataString) {
        if (!dataString) return '';
        const data = new Date(dataString);
        const idioma = document.getElementById('idioma').value;
        return data.toLocaleDateString(idioma, { month: 'long', year: 'numeric' });
    }

    // Função para atualizar os placeholders do formulário
    function atualizarPlaceholders() {
        const idioma = document.getElementById('idioma').value;
        const t = translations[idioma];
        
        atualizarTextos();
    }

    function atualizarTextos() {
        const idioma = document.getElementById('idioma').value;
        const t = translations[idioma];

        // Atualizar placeholders
        const placeholders = {
            nome: t.labels.placeholders.enterName,
            email: t.labels.placeholders.enterEmail,
            telefone: t.labels.placeholders.enterPhone,
            endereco: t.labels.placeholders.enterAddress,
            linkedin: t.labels.placeholders.enterLinkedIn,
            novaHabilidade: t.labels.placeholders.enterSkill
        };

        // Aplicar placeholders
        Object.entries(placeholders).forEach(([id, text]) => {
            const element = document.getElementById(id);
            if (element) element.placeholder = text;
        });

        // Atualizar textos da foto
        const fotoPreview = document.querySelector('.foto-preview.empty');
        if (fotoPreview) {
            fotoPreview.dataset.content = t.labels.photo.preview;
        }
        document.querySelector('.text-muted').textContent = t.labels.photo.maxSize;

        // Atualizar campos de experiência
        document.querySelectorAll('.experiencia-item').forEach(item => {
            const inputs = item.querySelectorAll('input, textarea');
            inputs[1].placeholder = t.labels.placeholders.company;
            inputs[2].placeholder = t.labels.placeholders.position;
            inputs[3].placeholder = t.labels.placeholders.startDate;
            inputs[4].placeholder = t.labels.placeholders.endDate;
            inputs[5].placeholder = t.labels.placeholders.activities;
        });

        // Atualizar campos de educação
        document.querySelectorAll('.educacao-item').forEach(item => {
            const inputs = item.querySelectorAll('input');
            inputs[1].placeholder = t.labels.placeholders.institution;
            inputs[2].placeholder = t.labels.placeholders.course;
            inputs[3].placeholder = t.labels.placeholders.startDate;
            inputs[4].placeholder = t.labels.placeholders.endDate;
        });

        // Atualizar marcadores de campos obrigatórios
        document.querySelectorAll('[required]').forEach(element => {
            const label = element.previousElementSibling;
            if (label && label.classList.contains('form-label')) {
                if (!label.textContent.includes(t.labels.required.marker)) {
                    label.textContent += t.labels.required.marker;
                }
            }
            element.title = t.labels.required.field;
        });

        // Atualizar título principal e labels
        document.querySelectorAll('label, h2, h3').forEach(element => {
            const text = element.textContent.toLowerCase();
            
            // Atualizar labels de campos
            if (element.classList.contains('form-label')) {
                const forAttr = element.getAttribute('for');
                if (t.labels.inputs[forAttr]) {
                    element.textContent = t.labels.inputs[forAttr];
                }
            }
            
            // Atualizar títulos de seção
            if (element.tagName === 'H3') {
                Object.entries(t.labels.formSections).forEach(([key, value]) => {
                    if (text.includes(key.toLowerCase())) {
                        element.textContent = value;
                    }
                });
            }
            
            // Atualizar título principal
            if (element.tagName === 'H2') {
                element.textContent = t.labels.form.title;
            }
        });

        // Atualizar textos dos botões
        document.getElementById('addExperiencia').textContent = t.labels.buttons.addExperience;
        document.getElementById('addEducacao').textContent = t.labels.buttons.addEducation;
        document.getElementById('gerarPDF').textContent = t.labels.buttons.generatePDF;
        document.getElementById('salvarLocal').textContent = t.labels.buttons.save;
        document.getElementById('carregarLocal').textContent = t.labels.buttons.load;

        // Atualizar texto do tamanho máximo da foto
        document.querySelector('.text-muted').textContent = t.labels.inputs.photoSize;

        // Atualizar botões de remover
        document.querySelectorAll('.remove-item').forEach(btn => {
            btn.textContent = t.labels.buttons.remove;
        });

        // Atualizar textos de campos obrigatórios
        document.querySelectorAll('[required]').forEach(element => {
            const label = element.previousElementSibling;
            if (label && label.classList.contains('form-label') && !label.textContent.includes('*')) {
                label.textContent += '*';
            }
        });

        // Atualizar texto da prévia
        const previewSection = document.querySelector('.preview-section');
        if (previewSection) {
            previewSection.setAttribute('aria-label', t.labels.preview);
        }
    }

    // Atualizar mensagens de alerta
    function mostrarAlerta(tipo) {
        const idioma = document.getElementById('idioma').value;
        const t = translations[idioma];
        alert(t.labels.alerts[tipo]);
    }

    function atualizarLabelsPersonalizacao() {
        const idioma = document.getElementById('idioma').value;
        const t = translations[idioma];
        
        // Atualizar títulos dos elementos de personalização
        document.getElementById('template').title = t.labels.template;
        document.getElementById('corPrimaria').title = t.labels.primaryColor;
        document.getElementById('corSecundaria').title = t.labels.secondaryColor;
        document.getElementById('fonte').title = t.labels.font;
        
        // Atualizar opções do template
        const templateSelect = document.getElementById('template');
        Array.from(templateSelect.options).forEach(option => {
            const templateKey = option.value;
            option.text = t.labels.templates[templateKey];
        });
    }

    function atualizarPrevia() {
        if (!validarFormulario()) return;

        const nome = document.getElementById('nome').value;
        const email = document.getElementById('email').value;
        const telefone = document.getElementById('telefone').value;
        const endereco = document.getElementById('endereco').value;
        const linkedin = document.getElementById('linkedin').value;
        const resumo = document.getElementById('resumo').value;
        const template = document.getElementById('template').value;
        const corPrimaria = document.getElementById('corPrimaria').value;
        const corSecundaria = document.getElementById('corSecundaria').value;
        const fonte = document.getElementById('fonte').value;
        const idioma = document.getElementById('idioma').value;
        const t = translations[idioma];
        const fotoSrc = fotoPreview.querySelector('img')?.src || '';

        let experiencias = [];
        document.querySelectorAll('.experiencia-item').forEach(item => {
            const inputs = item.querySelectorAll('input, textarea');
            experiencias.push({
                empresa: inputs[1].value,
                cargo: inputs[2].value,
                inicio: formatarData(inputs[3].value),
                fim: formatarData(inputs[4].value),
                descricao: inputs[5].value,
                cor: inputs[0].value
            });
        });

        let educacao = [];
        document.querySelectorAll('.educacao-item').forEach(item => {
            const inputs = item.querySelectorAll('input');
            educacao.push({
                instituicao: inputs[1].value,
                curso: inputs[2].value,
                inicio: formatarData(inputs[3].value),
                fim: formatarData(inputs[4].value),
                cor: inputs[0].value
            });
        });

        let habilidades = Array.from(document.querySelectorAll('#listaHabilidades .habilidade-tag'))
            .map(tag => tag.childNodes[0].nodeValue.trim())
            .filter(text => text.length > 0);

        // Aplicar template e estilos ao preview
        previewContainer.style.setProperty('--cor-primaria', corPrimaria);
        previewContainer.style.setProperty('--cor-secundaria', corSecundaria);
        previewContainer.style.setProperty('--gradient-primary', 
            `linear-gradient(135deg, ${corPrimaria} 0%, ${corSecundaria} 100%)`);
        previewContainer.style.fontFamily = fonte;
        previewContainer.className = `preview-container template-${template}`;
        previewContainer.setAttribute('lang', idioma);
        
        previewContainer.innerHTML = `
            ${fotoSrc ? `
                <div class="text-center mb-4">
                    <img src="${fotoSrc}" alt="Foto de perfil" 
                         style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover;">
                </div>
            ` : ''}
            <h1>${nome || 'Seu Nome'}</h1>
            
            <div class="contato-info">
                ${email ? `<p><strong>${t.labels.email}:</strong> ${email}</p>` : ''}
                ${telefone ? `<p><strong>${t.labels.phone}:</strong> ${telefone}</p>` : ''}
                ${endereco ? `<p><strong>${t.labels.address}:</strong> ${endereco}</p>` : ''}
                ${linkedin ? `<p><strong>LinkedIn:</strong> <a href="${linkedin}">${linkedin}</a></p>` : ''}
            </div>

            ${resumo ? `
                <h2>${t.titles.summary}</h2>
                <p>${resumo}</p>
            ` : ''}
            
            ${experiencias.length ? `
                <h2>${t.titles.experience}</h2>
                ${experiencias.map(exp => `
                    <div class="experiencia-entry" style="
                        --card-color: ${exp.cor};
                        --card-color-rgb: ${hexToRgb(exp.cor)};">
                        <h3>${exp.empresa}</h3>
                        <h4>${exp.cargo}</h4>
                        <p class="periodo">
                            <i class="fas fa-briefcase"></i>
                            ${exp.inicio ? exp.inicio : ''} 
                            ${exp.inicio && exp.fim ? ' - ' : ''} 
                            ${exp.fim ? exp.fim : t.labels.current}
                        </p>
                        <p class="descricao">${exp.descricao}</p>
                    </div>
                `).join('')}
            ` : ''}

            ${educacao.length ? `
                <h2>${t.titles.education}</h2>
                ${educacao.map(edu => `
                    <div class="educacao-entry" style="
                        --card-color: ${edu.cor};
                        --card-color-rgb: ${hexToRgb(edu.cor)};">
                        <h3>${edu.instituicao}</h3>
                        <h4>${edu.curso}</h4>
                        <p class="periodo">
                            <i class="fas fa-calendar-alt"></i>
                            ${edu.inicio ? edu.inicio : ''} 
                            ${edu.inicio && edu.fim ? ' - ' : ''} 
                            ${edu.fim ? edu.fim : t.labels.current}
                        </p>
                    </div>
                `).join('')}
            ` : ''}

            ${habilidades.length ? `
                <h2>${t.titles.skills}</h2>
                <div class="habilidades-container">
                    ${habilidades
                        .map(hab => `<span class="habilidade-tag">${hab}</span>`).join('')}
                </div>
            ` : ''}
        `;
    }

    function salvarDadosLocal() {
        const dados = {
            nome: document.getElementById('nome').value,
            email: document.getElementById('email').value,
            telefone: document.getElementById('telefone').value,
            endereco: document.getElementById('endereco').value,
            linkedin: document.getElementById('linkedin').value,
            resumo: document.getElementById('resumo').value,
            experiencias: Array.from(document.querySelectorAll('.experiencia-item')).map(item => {
                const inputs = item.querySelectorAll('input, textarea');
                return {
                    empresa: inputs[1].value,
                    cargo: inputs[2].value,
                    inicio: inputs[3].value,
                    fim: inputs[4].value,
                    descricao: inputs[5].value,
                    cor: inputs[0].value
                };
            }),
            educacao: Array.from(document.querySelectorAll('.educacao-item')).map(item => {
                const inputs = item.querySelectorAll('input');
                return {
                    instituicao: inputs[1].value,
                    curso: inputs[2].value,
                    inicio: inputs[3].value,
                    fim: inputs[4].value,
                    cor: inputs[0].value
                };
            }),
            habilidades: Array.from(listaHabilidades.querySelectorAll('.habilidade-tag'))
                .map(tag => tag.textContent.trim().replace('×', '')),
            template: document.getElementById('template').value,
            corPrimaria: document.getElementById('corPrimaria').value,
            corSecundaria: document.getElementById('corSecundaria').value,
            fonte: document.getElementById('fonte').value,
            foto: fotoPreview.querySelector('img')?.src || '',
        };

        localStorage.setItem('curriculoData', JSON.stringify(dados));
        mostrarAlerta('dataSaved');
    }

    function carregarDadosLocal() {
        const dados = JSON.parse(localStorage.getItem('curriculoData'));
        if (!dados) {
            mostrarAlerta('noData');
            return;
        }

        // Carregar dados básicos
        document.getElementById('nome').value = dados.nome || '';
        document.getElementById('email').value = dados.email || '';
        document.getElementById('telefone').value = dados.telefone || '';
        document.getElementById('endereco').value = dados.endereco || '';
        document.getElementById('linkedin').value = dados.linkedin || '';
        document.getElementById('resumo').value = dados.resumo || '';
        document.getElementById('template').value = dados.template || 'minimal';
        document.getElementById('corPrimaria').value = dados.corPrimaria || '#0d6efd';
        document.getElementById('corSecundaria').value = dados.corSecundaria || '#6610f2';
        document.getElementById('fonte').value = dados.fonte || 'Arial, sans-serif';

        // Limpar e recarregar experiências
        document.getElementById('experiencias').innerHTML = '';
        dados.experiencias.forEach(exp => {
            adicionarItem('experiencias', criarExperienciaHTML);
            const items = document.querySelectorAll('.experiencia-item');
            const lastItem = items[items.length - 1];
            const inputs = lastItem.querySelectorAll('input, textarea');
            inputs[1].value = exp.empresa;
            inputs[2].value = exp.cargo;
            inputs[3].value = exp.inicio;
            inputs[4].value = exp.fim;
            inputs[5].value = exp.descricao;
            inputs[0].value = exp.cor;
        });

        // Limpar e recarregar educação
        document.getElementById('educacao').innerHTML = '';
        dados.educacao.forEach(edu => {
            adicionarItem('educacao', criarEducacaoHTML);
            const items = document.querySelectorAll('.educacao-item');
            const lastItem = items[items.length - 1];
            const inputs = lastItem.querySelectorAll('input');
            inputs[1].value = edu.instituicao;
            inputs[2].value = edu.curso;
            inputs[3].value = edu.inicio;
            inputs[4].value = edu.fim;
            inputs[0].value = edu.cor;
        });

        // Limpar e recarregar habilidades
        listaHabilidades.innerHTML = '';
        dados.habilidades.forEach(hab => {
            const habilidadeElement = document.createElement('span');
            habilidadeElement.className = 'habilidade-tag';
            
            habilidadeElement.textContent = hab;
            const removerBtn = document.createElement('span');
            removerBtn.className = 'remover';
            removerBtn.textContent = '×';
            habilidadeElement.appendChild(removerBtn);
            
            removerBtn.addEventListener('click', function() {
                habilidadeElement.remove();
                atualizarPrevia();
            });
            
            listaHabilidades.appendChild(habilidadeElement);
        });

        // Carregar foto
        if (dados.foto) {
            fotoPreview.innerHTML = `<img src="${dados.foto}" alt="Foto de perfil">`;
            fotoPreview.classList.remove('empty');
        } else {
            fotoPreview.innerHTML = '';
            fotoPreview.classList.add('empty');
        }

        atualizarPrevia();
        mostrarAlerta('dataLoaded');
    }

    async function gerarPDF() {
        try {
            const element = document.getElementById('curriculo-preview');
            
            // Configurar opções do html2canvas
            const canvas = await html2canvas(element, {
                scale: 2, // Melhor qualidade
                useCORS: true, // Permitir imagens de outros domínios
                logging: false // Desativar logs
            });
            
            // Configurar o PDF
            const imgData = canvas.toDataURL('image/jpeg', 1.0);
            const pdf = new jspdf.jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4'
            });
            
            // Calcular dimensões
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const pdfHeight = pdf.internal.pageSize.getHeight();
            const imgWidth = canvas.width;
            const imgHeight = canvas.height;
            const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
            const imgX = (pdfWidth - imgWidth * ratio) / 2;
            const imgY = 0;

            // Adicionar a imagem ao PDF
            pdf.addImage(
                imgData, 'JPEG',
                imgX, imgY,
                imgWidth * ratio,
                imgHeight * ratio
            );

            // Salvar o PDF
            const idioma = document.getElementById('idioma').value;
            const fileName = translations[idioma].labels.form.title.toLowerCase().replace(/\s+/g, '_') + '.pdf';
            pdf.save(fileName);
        } catch (error) {
            console.error('Erro ao gerar PDF:', error);
            const idioma = document.getElementById('idioma').value;
            alert(translations[idioma].labels.alerts.pdfError || 'Erro ao gerar o PDF. Por favor, tente novamente.');
        }
    }

    // Adicionar delegação de eventos para os botões de remover
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('remove-item')) {
            const item = e.target.closest('.experiencia-item, .educacao-item');
            if (item) {
                item.remove();
                atualizarPrevia();
            }
        }
    });

    // Inicializar prévia
    atualizarPrevia();

    // Função auxiliar para converter hex para rgb
    function hexToRgb(hex) {
        const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result ? 
            `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : 
            '13, 110, 253';  // fallback para azul padrão
    }

    function atualizarIdioma() {
        const idioma = document.getElementById('idioma').value;
        document.getElementById('htmlRoot').setAttribute('lang', idioma);
        const t = translations[idioma];
        
        // Atualizar título da página
        document.title = t.pageTitle;
        
        // Atualizar elementos do header
        document.getElementById('idioma').title = t.customization.selectLanguage;
        document.getElementById('template').title = t.customization.selectTemplate;
        document.getElementById('corPrimaria').title = t.customization.primaryColor;
        document.getElementById('corSecundaria').title = t.customization.secondaryColor;
        document.getElementById('fonte').title = t.customization.selectFont;
        
        // Atualizar grupos de fontes
        document.querySelectorAll('optgroup').forEach(group => {
            const label = group.getAttribute('label').toLowerCase();
            if (label.includes('sans serif')) group.setAttribute('label', t.customization.fontGroups.sansSerif);
            if (label.includes('serif') && !label.includes('sans')) group.setAttribute('label', t.customization.fontGroups.serif);
            if (label.includes('monospace')) group.setAttribute('label', t.customization.fontGroups.monospace);
        });
        
        // Atualizar o resto da página
        atualizarPlaceholders();
        atualizarLabelsPersonalizacao();
        atualizarPrevia();
    }

    // Atualizar o event listener do idioma
    document.getElementById('idioma').addEventListener('change', atualizarIdioma);

    // Inicializar a tradução
    document.addEventListener('DOMContentLoaded', function() {
        atualizarIdioma();
    });
}); 